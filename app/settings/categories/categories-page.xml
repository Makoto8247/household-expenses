<Page xmlns="http://schemas.nativescript.org/tns.xsd" loaded="onLoaded">
    <ActionBar title="ã‚«ãƒ†ã‚´ãƒªè¨­å®š">
    </ActionBar>
    
    <ScrollView>
        <StackLayout padding="16">
            
            <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
            <Button 
                text="æˆ»ã‚‹" 
                tap="onBackTap"
                backgroundColor="#D84315"
                color="#FFFFFF"
                borderRadius="8"
                padding="12"
                fontSize="16"
                horizontalAlignment="left"
                marginBottom="16" />

            <!-- ã‚«ãƒ†ã‚´ãƒªè¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <Label text="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ " class="h3" marginBottom="16" />
            
            <!-- ã‚¢ã‚¤ã‚³ãƒ³é¸æŠž -->
            <StackLayout marginBottom="16">
                <Label text="ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠžï¼ˆä»»æ„ï¼‰" fontSize="14" marginBottom="4" />
                <Button text="{{ selectedIcon || 'ðŸ“' }}" 
                        tap="onToggleIconPicker" 
                        fontSize="24" 
                        width="60" 
                        height="50"
                        backgroundColor="{{ selectedIcon ? '#e3f2fd' : '#f5f5f5' }}"
                        borderRadius="8"
                        horizontalAlignment="left"
                        marginBottom="8" />
                
                <!-- ã‚«ãƒ†ã‚´ãƒªåå…¥åŠ›ã¨è¿½åŠ ãƒœã‚¿ãƒ³ -->
                <StackLayout orientation="horizontal">
                    <TextField 
                        text="{{ newCategoryName }}" 
                        hint="ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›"
                        width="70%" />
                    <Button 
                        text="è¿½åŠ " 
                        tap="{{ addCategory }}"
                        class="btn-primary"
                        width="25%" 
                        marginLeft="5%" />
                </StackLayout>
                
                <!-- çµµæ–‡å­—é¸æŠžãƒ‘ãƒãƒ« -->
                <StackLayout visibility="{{ showIconPicker ? 'visible' : 'collapsed' }}" 
                             backgroundColor="#ffffff" 
                             padding="8" 
                             borderRadius="8"
                             marginTop="8">
                    <Label text="çµµæ–‡å­—ã‚’é¸æŠžã—ã¦ãã ã•ã„:" fontSize="14" marginBottom="8" />
                    <ScrollView height="120" width="100%">
                        <WrapLayout orientation="horizontal" width="100%">
                            <Repeater items="{{ iconList }}">
                                <Repeater.itemTemplate>
                                    <Button text="{{ $value }}" 
                                            tap="onSelectIcon" 
                                            backgroundColor="transparent" 
                                            fontSize="28" 
                                            width="45" 
                                            height="50" 
                                            margin="2" />
                                </Repeater.itemTemplate>
                            </Repeater>
                        </WrapLayout>
                    </ScrollView>
                    <Button text="é¸æŠžå®Œäº†" tap="onToggleIconPicker" class="btn-secondary" marginTop="8" />
                </StackLayout>
            </StackLayout>
            
            
            <!-- ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ -->
            <Label text="ç™»éŒ²æ¸ˆã¿ã‚«ãƒ†ã‚´ãƒª" class="h3" marginBottom="8" />
            
            <ListView 
                items="{{ categories }}" 
                height="400"
                separatorColor="#E0E0E0">
                <ListView.itemTemplate>
                    <StackLayout orientation="horizontal" padding="12">
                        <Label text="{{ icon }}" fontSize="20" verticalAlignment="center" width="15%" textAlignment="center" />
                        <Label 
                            text="{{ name }}" 
                            verticalAlignment="center"
                            width="45%" 
                            marginLeft="8" />
                        <Button 
                            text="ç·¨é›†" 
                            tap="onEditCategory"
                            class="btn-secondary"
                            width="15%" 
                            marginRight="5%" />
                        <Button 
                            text="å‰Šé™¤" 
                            tap="onDeleteCategory"
                            class="btn-danger"
                            width="15%" />
                    </StackLayout>
                </ListView.itemTemplate>
            </ListView>
            
            <ActivityIndicator busy="{{ isLoading }}" marginTop="16" />
            
            <!-- ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆéžè¡¨ç¤ºï¼‰ -->
            <StackLayout visibility="{{ isEditing ? 'visible' : 'collapsed' }}" 
                         backgroundColor="#F5F5F5" 
                         padding="16" 
                         marginTop="16">
                <Label text="ã‚«ãƒ†ã‚´ãƒªã‚’ç·¨é›†" class="h3" marginBottom="8" />
                
                <!-- ç·¨é›†ç”¨ã‚¢ã‚¤ã‚³ãƒ³é¸æŠž -->
                <StackLayout marginBottom="8">
                    <Label text="ã‚¢ã‚¤ã‚³ãƒ³" fontSize="14" marginBottom="4" />
                    <StackLayout orientation="horizontal" marginBottom="8">
                        <Button text="{{ editSelectedIcon || 'ðŸ“' }}" 
                                tap="onToggleEditIconPicker" 
                                fontSize="24" 
                                width="60" 
                                height="50"
                                backgroundColor="{{ editSelectedIcon ? '#e3f2fd' : '#f5f5f5' }}"
                                borderRadius="8" />
                    </StackLayout>
                    
                    <!-- ç·¨é›†ç”¨çµµæ–‡å­—é¸æŠžãƒ‘ãƒãƒ« -->
                    <StackLayout visibility="{{ isEditingIcon ? 'visible' : 'collapsed' }}" 
                                 backgroundColor="#ffffff" 
                                 padding="8" 
                                 borderRadius="8"
                                 marginBottom="8">
                        <Label text="çµµæ–‡å­—ã‚’é¸æŠžã—ã¦ãã ã•ã„:" fontSize="14" marginBottom="8" />
                        <ScrollView height="120" width="100%">
                            <WrapLayout orientation="horizontal" width="100%">
                                <Repeater items="{{ iconList }}">
                                    <Repeater.itemTemplate>
                                        <Button text="{{ $value }}" 
                                                tap="onSelectEditIcon" 
                                                backgroundColor="transparent" 
                                                fontSize="24" 
                                                width="45" 
                                                height="45" 
                                                margin="2" />
                                    </Repeater.itemTemplate>
                                </Repeater>
                            </WrapLayout>
                        </ScrollView>
                        <Button text="é¸æŠžå®Œäº†" tap="onToggleEditIconPicker" class="btn-secondary" marginTop="8" />
                    </StackLayout>
                </StackLayout>
                
                <TextField 
                    text="{{ editCategoryName }}" 
                    hint="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªå"
                    marginBottom="8" />
                <StackLayout orientation="horizontal">
                    <Button 
                        text="ä¿å­˜" 
                        tap="onSaveCategory"
                        class="btn-primary"
                        width="45%" />
                    <Button 
                        text="ã‚­ãƒ£ãƒ³ã‚»ãƒ«" 
                        tap="onCancelEdit"
                        class="btn-secondary"
                        width="45%" 
                        marginLeft="10%" />
                </StackLayout>
            </StackLayout>
        </StackLayout>
    </ScrollView>
</Page>